## 2.5DNS：因特网的目录服务器

> 主机由主机名标识，但并不能由此得出主机在互联网中的位置信息，因此，一般用IP地址进行标识

IP地址简介：一个IP地址由四个字节组成，每个字节都被句点分隔开，表示0~255的十进制数字。其具有层次结构，从左向右扫描会得到越来越具体的主机在因特网何处的信息（即位于哪个网络中）。

#### 2.5.1DNS提供的服务

> 由于人们喜欢记忆主机名具有意义的名字，路由器喜欢定长且有层次结构的IP地址，因此需要一种能进行主机名到IP地址转换的目录服务，即域名系统（DNS）

DNS是：

* 一个由分层的DNS服务器实现的分布式数据库
* 一个使得主机能够查询分布式数据库的应用协议（DNS协议）

注：DNS协议运行在UDP之上

---

> 通常DNS由其他应用层协议所使用，将用户的主机名解析为IP地址

过程为：

* 同一台用户主机上运行着DNS应用的客户端
* 浏览器从上述URL中抽取出主机名，并将这台主机名传给DNS应用的客户端
* DNS客户向DNS服务器发送一个包含主机名的请求
* DNS最终收到一个回答报文，包含该主机名的IP地址
* 浏览器向该IP地址80端口的HTTP服务器进程发起一个TCP连接

---

**DNS提供的其它服务**

* 主机别名：有着复杂主机名的主机能拥有一个或多个别名，其中一个被称为规范主机名，其余被称为主机别名。主机别名比规范名更好记忆。应用程序可以调用DNS来获得主机别名对应的规范名和IP地址
* 邮件服务器别名：邮件服务器的主机名不如电子邮件地址那样好记，因此，可以调用DNS对提供的邮件服务器别名进行解析，以获得该主机的规范主机名及其IP地址。
* 负载分配：DNS也用于冗余的服务器之间进行负载分配。 由于一些站点繁忙，因此会被冗余分布到多台服务器上，每台服务器均运行在不同的端系统上，每个都有着不同的IP地址。因此，一个IP地址集合与同一个规范主机名相联系。DNS数据库中存储着这些IP地址的集合，对用户响应进行循环返回这些地址。

#### 2.5.2DNS工作机理概述

**集中式设计**

> 因特网上只使用一个DNS服务器，该服务器包含所有的映射。

问题：

* 单点故障：如果该服务器崩溃，整个网络都会瘫痪
* 通信容量：单个DNS服务器不得不处理所有的DNS查询
* 远距离的集中式数据库：单个DNS服务器不可能临近所有查询用户。部分用户因此会有严重的延迟
* 维护：单个DNS服务器必须为所有主机保存记录，使得中央数据库非常庞大，且更新非常频繁

> 因此，DNS采用分布式的设计方案

##### 1.分布式、层次数据库

> 为了处理扩展性问题，DNS使用了大量的DNS服务器，以层次方式组织，并且分布在全世界范围内。

有3种类型的DNS服务器：根DNS服务器，顶级域DNS服务器和权威DNS服务器。详细如下：

* 根DNS服务器：在因特网上有13个根DNS服务器，尽管它们每个都被视为单个的服务器，但每台服务器实际上是一个冗余的服务器网络，提供安全性和可靠性
* 顶级域DNS服务器：这些服务器负责顶级域名如com、org、net、edu和gov等
* 权威DNS服务器：在因特网上具有公共可访问主机的每个组织机构必须提供公共可访问的DNS记录，这些记录将这些主机的名字映射为IP地址。

**本地DNS服务器**

> 每个ISP都有一台本地DNS服务器。当主机与某个ISP连接时，该ISP提供一台主机的IP地址，该主机具有一台或多台其本地DNS服务器的IP地址。

本地DNS服务器代理主机进行DNS查询

##### 2.DNS缓存

> 为了改善时延性能，本地DNS服务器常常采用将收到的DNS回答缓存在本地存储器中。

#### 2.5.3DNS记录和报文

> DNS服务器存储了资源记录，该记录提供了主机名到IP地址的映射

资源记录包含以下字段的4元组：

* Name
* Value
* Type
* TTL（该记录的生存时间，即应当从缓存中删除的时间）

同时分为以下情况：

* Type = A：Name是主机名，Value是IP地址
* Type = NS：Name是个域，Value是能够获得该域中主机IP地址的权威DNS服务器的主机名
* Type = CNAME：Value是别名为Name的主机对应的规范主机名
* Type = MX：Value是别名是Name的邮件服务器对应的规范主机名

##### 1.DNS报文

> DNS只有查询和回答报文两种，并且具有相同的格式

组成格式如下：

* 前12字节是**首部区域**
	* 第一个字段（标识符）是一个16比特的数，用于标识该查询
	* 第二个字段（标志字段）含有若干标志
		* 1比特用于标志查询还是回答
		* 1比特的“权威”标志位
		* 1比特的“希望递归”标志位
		* 1比特的“递归可用”标志位
	* 4个有关数量的字段
* **问题区域**包含正在进行的查询信息
	* 名字字段，即查询的主机名
	* 类型字段，指出询问的问题的类型（Type）
* **回答区域**包含了对最初请求的名字的资源记录
* **权威区域**包含了其它权威服务器的记录
* **附加区域**包含了其它有帮助的记录

##### 2.在DNS数据库中插入记录

注册域名时，需要提供基本和辅助权威DNS服务器的名字和IP地址



