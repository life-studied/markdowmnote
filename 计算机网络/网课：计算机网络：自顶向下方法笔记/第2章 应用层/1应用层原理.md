## 应用层原理

### 网络应用的体系结构

* 客户-服务器模式（c/s模式）
* 对等模式（P2P模式）
* 混合型（c/s和P2P）

#### 客户-服务器模式（c/s模式）

##### 服务器

* 一直运行
* 固定IP和约定端口
* 扩展性：服务器场（扩展性差）

##### 客户端

* 主动与服务器进行通信
* 与互联网间歇性连接
* 可能是动态IP
* 不直接与其它客户端通信、

#### 对等模式（P2P模式）

* 没有一直运行的服务器
* 任意端系统之间都可以进行通信
* 每一个节点既是客户端也是服务器
	* 自扩展性（新的peer节点带来新的服务能力与服务请求）

* 参与的主机间歇性连接且可以改变IP地址
	* 难以管理

#### 混合型（c/s和P2P）

##### Napster

* 文件搜索：集中
	* 主机点中心服务器上注册其资源
	* 主机向中心服务器查询资源管理
* 文件传输：P2P
	* 在任意Peer节点之间

##### 即时通信

* 在线检测：集中
	* 当用户上线时，向中心服务器注册其IP地址
	* 用户与中心服务器联系，找到在线好友位置
* 用户之间聊天：P2P

### 进程通信

> 进程：在主机上运行的应用程序

---

* 同一个主机内：使用进程间通信机制通信（操作系统定义）
* 不同主机之间：通过交换报文（Message）来通信
	* 使用OS提供的通信服务
	* 按照应用协议交换报文
		* 借助传输层提供的服务

##### 客户端进程：发起通信的进程

##### 服务器进程：等待连接的进程

> 注意：P2P架构的应用也有客户端进程和服务器进程之分

---

### 分布式进程通信需要解决的问题

* 1.进程标示与寻址问题

* 2.传输层——应用层提供服务是如何
	* 位置：层间界面的SAP（TCP/IP，socket）
	* 形式：应用程序接口API
* 3.如果使用传输层提供的服务，实现应用进程之间的报文交换，实现应用
	* 定义应用层协议：报文格式、解释、时序
	* 编制程序，使用OS提供的API调用网络基础设施提供通信服务传报文、实现应用时序等。

#### 对进程进行编址

* 进程为了接收报文，必须有一个标识，即SAP
	* 主机：唯一的32位IP地址
		* 仅有IP只能标识到主机，不能标识到进程（一个主机上有多个进程）
	* 传输层协议：TCP/UDP
	* 端口号
* 一些端口约定：
	* HTTP：80
	* Mail：25
	* FTP：2
* 本质上，一对主机进程之间的通信由两个端节点构成

#### 传输层提供的服务——需要穿过层间的信息

* 层间接口必须要携带的信息
	* 要传输的报文（对本层而言是SDU）
	* 谁传的：对方应用进程的标识：对方的IP+TCP（UDP）端口号
	* 传给谁：对方的应用进程的标识：对方的IP+TCP（UDP）端口号

* 传输层实体根据这些信息进行TCP报文段的封装
	* 源端口号、目标端口号、数据
	* 将IP地址往下交给IP实体、用于封装IP数据报、源IP、目标IP

#### 传输层提供的服务——层间信息的代表

* 如果Socket API每次传输报文，都携带如此多的信息，太繁琐，不易管理
* 用单个代号标识通信双方或单方：socket
* 就像OS打开文件返回句柄一样
	* 对句柄的操作，就是对文件的操作
* TCP socket：
	* TCP服务，两个进程之间的通信需要之前建立连接
		* 两个进程通信会持续一段时间，通信关系稳定
	* 可以用一个整数来表示两个应用实体之间的通信关系，本地标识
	* 穿过层间的接口信息量最小
	* TCP socket：源IP，源端口，目标IP，目标端口

---

##### TCP socket

* 对于使用面向连接的服务应用而言，socket是4元组的一个具有本地意义的标识
	* 4元组：源IP、源port、目标IP、目标port
	* 唯一的指定了一个会话（两个进程之间的会话关系）
	* 应用使用这个标识，与远程的应用进程通信
	* 不必再每一个报文的发送都要指定这4元组
	* 简单，易于管理

##### UDP socket

* UDP服务，两个应用进程之间的通信需要之前无需建立连接
	* 每个报文都是独立传输的
	* 前后报文可能给不同的分布式应用
* 因此，只能用一个整数表示本应用实体的标示
* 穿过层间接口的信息大小最小
* UDP socket：本IP、本端口
* 传输报文时，必须提供对方的IP和端口
	* 接收报文时，传输层上传对方的IP、port

#### 安全TCP

> 由于TCP和UDP都没有加密，且都以明文的形式传输数据
>
> 因此使用SSL在TCP上实现加密的连接
>
> 采用的方式为：SSL库

