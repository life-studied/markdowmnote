---
create: '2025-12-07'
modified: '2025-12-07'
---

# 组合优于继承

## 理论分析

为什么说组合优于继承？

继承从理论上来看，非常完美，A is B，所以A具有B的特性。这是一种学院派的观点，非常理想化，但在实践中经常发现，不仅A is B，而且A is C......也就是说，继承本质上是从某个角度观察事物的特性，而事物又可以有多个角度。

这就导致在实践中，继承非常死板僵化：人是动物，也是物理世界下的物体，那么他的move方法，到底是使用动物的move，还是用物理上的move呢？那如果人还有一些独特的move呢？

一旦继承，就必然引入了依赖，而上游依赖的编写，往往早于现在，且不能被改动，这种依赖会对现在产生非常大的限制。

如果用接口/虚类呢？接口有很多好处，例如规定了函数方法，并把实现交给了下游，且还会检查方法的正确性。至少它比继承一个实类要好。

## 与其使用interface，不如使用concept

使用接口有没有什么坏处呢？有，接口往往强制实现，即使你不需要它的部分函数。接口还引入了额外的思维负担，要求必须了解全部函数才能去做。

最坏的是，接口是侵入式的。当你要实现接口时，必须显式地去继承接口，然后去实现它。

> 在C++中，接口还需要考虑到虚函数表的性能问题。

所以，接口其实不如concept。

使用concept的好处是，它是非侵入式的。当某个函数需要concept时，它会注明需要哪些函数：

```C++
template <typename T>
requires requires(T t) {
	t.move();
}
void move_multi(T& t, int times) {
    for(int i = 0; i < times; ++i) {
		t.move();
    }
}
```

即使没有也没事，可以后续直接加一个Adaptor就行，而不需要修改源码：

```C++
struct People {
    int age;
    std::string name;
    ...
};

class PeopleMoveAdaptor {
    PeopleMoveAdaptor(People& p) : p_(p) {};
    void move() {
        ...
    }
    People& p_;
};
```