---
create: '2025-12-07'
modified: '2025-12-07'
---

# Node.js 与浏览器：基于v8的不同 js 运行体系

作为 JavaScript 开发者，每天都在浏览器和 Node.js 之间切换。有一个问题：同一门语言为何能在两个截然不同的领域运行？

## 1. js的三层架构

任何js代码的执行，都依赖v8引擎去做解析和翻译。浏览器和 Node.js 也不例外。它们的差异完全体现在，前置注入的上下文对象不同。

## 2. V8 引擎

V8 并非完整的运行时，而是一个**可嵌入的 C++ 库**。任何宿主程序（浏览器或 Node.js）都遵循此模式：**不修改 V8 源码，仅通过其 API 扩展全局对象**，从而构建出不同的上下文环境。

```cpp
// 一切开始之前：向 v8 引擎上下文注入自定义对象
v8::Local<v8::Object> global = context->Global();
global->Set("customAPI", BindNativeFunction(...));

// 初始化上下文完成后，开始执行用户代码
v8::Script::Compile("customAPI.doSomething()");
```

## 3. 浏览器和nodejs

nodejs是服务端运行js代码的解释器，可以简单看作是python解释器。

浏览器和nodejs都能解析和执行js代码，它们有什么关系？

```plaintext
┌─────────────────────────────────┐
│        Node.js 运行环境          │
├─────────────────────────────────┤
│ node.js 预先注入的上下文         	│
│ V8 引擎（解析 JS 代码）         	│ ← 和浏览器内核里的 V8 是同一份
│ C++ 						      │
│ 操作系统						   │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│        浏览器 运行环境           │
├─────────────────────────────────┤
│ 浏览器 预先注入的上下文           │
│ V8 引擎（解析 JS 代码）         	│ ← 和node.js里的 V8 是同一份
│ C++ 						      │
│ 操作系统						   │
└─────────────────────────────────┘
```

---

问："那直接把浏览器API搬到服务器不就行了？"

**Node.js 真正的创新是 libuv**，它让 V8 能够非阻塞地执行文件 I/O。

> Node.js 与浏览器的根本差异在于 **事件循环的实现** 和 **异步 I/O 的范围**。
>
> 浏览器的事件循环由渲染进程驱动，仅支持网络请求；Node.js 使用 libuv，将异步能力扩展到文件系统、DNS、子进程等系统调用。

```
┌─────────────────────────────────┐
│        Node.js 进程             │
├─────────────────────────────────┤
│ ①  C++层面向 v8 注入 			  │
│    global, process, 			  │
│    libuv 事件循环, fs/http 模块  │
├─────────────────────────────────┤
│ ② V8 引擎：解析执行 JS 代码       │
├─────────────────────────────────┤
│ ③ libuv 层：跨平台异步 I/O       │
└─────────────────────────────────┘
			操作系统

┌─────────────────────────────────┐
│        浏览器渲染进程            │
├─────────────────────────────────┤
│ ①  C++层面向 v8 注入 			  │
│    window, document,			  │
│    Blink 渲染引擎, 浏览器事件循环 │
├─────────────────────────────────┤
│ ② V8 引擎：解析执行 JS 代码      │
├─────────────────────────────────┤
│ ③ Blink 层：DOM/CSS 渲染        │
└─────────────────────────────────┘
			操作系统
```

## 4. 前端开发为何依赖 Node.js？

很多在浏览器上的前端代码，为什么又需要依赖Node.js去做开发呢？例如Vue，人家是跑在浏览器里的，要nodejs干嘛？

Vue 最终运行不依赖 Node.js，但**开发时的编译流水线**基于 Node.js 实现。

> 没有 Node.js，浏览器理解不了.vue 文件。在nodejs的运行环境里，它们可以拉取并运行自己的编译器，将.vue转换成js代码。

从本质上来说，如果有另一个能编译 Vue 到 js 的编译器，那完全用不着 nodejs 的运行环境。但Vue 的开发工具是用 JavaScript/TypeScript 写的，它们必须运行在 JavaScript 运行时上。因此nodejs作为服务器端 JavaScript 运行环境的事实标准，自然是 Vue 开发工具的首选运行环境。

既然选择了nodejs，那么npm作为Vue的开发环境的包管理器也很合理。