---
create: '2025-01-23'
modified: '2025-01-23'
---

# 核函数

## 核函数格式要求

1. 核函数在GPU上并行执行。

2. 说明：

   1. 限定词`__global__`修饰
   2. 返回值必须是`void`

3. 形式

   ```C++
   __global__ void kernal_function(argument arg) {
       printf("Hello World from the GPU!\n");
   }
   ```

## 核函数使用示例

```C++
#include <cstdio>

__global__ void kernel() {
  printf("Hello, world from the device!\n");
}

int main() {
  kernel<<<1, 1>>>();		// 1 * 1
  cudaDeviceSynchronize();	// 总线同步
  return 0;
}
```

一块GPU中有很多（例如，TeslaV100中有5120个）计算核心，从而可以支持很多线程（thread）。主机在调用一个核函数时，必须指明需要在设备中指派多少个线程，不然设备不知道如何工作。

三括号中的数就是用来指明核函数中的线程数目以及排列情况的。核函数中的线程常组织为若干线程块（threadblock）：三括号中的第一个数字可以看作线程块的个数，第二个数字可以看作每个线程块中的线程数。

一个核函数的全部线程块构成一个网格（grid），而线程块的个数就记为网格大小（gridsize）。每个线程块中含有同样数目的线程，该数目称为线程块大小（blocksize）。所以，核函数中总的线程数就等于网格大小乘以线程块大小，而三括号中的两个数字分别就是网格大小和线程块大小，即<<<网格大小，线程块大小>>>。所以，在上述程序中，主机只指派了设备的一个线程，网格大小和线程块大小都是1，即1*1。

## 核函数注意事项

* 核函数只能访问GPU内存
* 核函数不能使用变长参数
* 核函数不能使用静态变量
* 核函数不能使用函数指针
* 核函数具有异步性