---
create: '2025-02-24'
modified: '2025-02-24'
---

# 占位符说明

## 简略占位符表

以下是 `fmt` 包中占位符的简略表格，包括常见的类型：

| 占位符 | 类型           | 说明                                                         | 备注                              |
| ------ | -------------- | ------------------------------------------------------------ | --------------------------------- |
| `%v`   | 通用           | 默认格式显示值。对于结构体，`%+v` 显示字段名，`%#v` 显示 Go 语法表示。 | 适用于所有类型                    |
| `%T`   | 通用           | 显示值的 Go 类型                                             | 适用于所有类型                    |
| `%%`   | 通用           | 显示字面量百分号，不消耗值                                   | 无                                |
| `%t`   | 布尔           | 显示布尔值（`true` 或 `false`）                              | 无                                |
| `%c`   | 整数/rune/byte | 对应的 Unicode 码点表示的字符                                | 无                                |
| `%d`   | 整数           | 十进制表示                                                   | 无                                |
| `%f`   | 浮点数         | 小数点表示，不带指数                                         | `%F` 是其别名                     |
| `%s`   | 字符串         | 显示字符串的原始内容                                         | 无                                |
| `%p`   | 指针/切片      | 显示地址或指针值，带 `0x` 前缀                               | 适用于指针和切片的第 0 个元素地址 |

### **通用占位符：**

```
%v：以默认格式显示值。
     当打印结构体时，使用加号标志 (%+v) 会显示字段名称。
%#v：以 Go 语法显示值。
     （浮点数的无穷大和 NaN 会显示为 ±Inf 和 NaN）
%T：以 Go 语法显示值的类型。
%%：显示一个字面量百分号；不消耗任何值。
```

### **布尔值：**

```
%t：显示 true 或 false。
```

### **整数：**

```
%b：二进制表示。
%c：对应的 Unicode 码点表示的字符。
%d：十进制表示。
%o：八进制表示。
%O：八进制表示，带 0o 前缀。
%q：以 Go 语法安全转义的单引号字符字面量。
%x：十六进制表示，使用小写字母 a-f。
%X：十六进制表示，使用大写字母 A-F。
%U：Unicode 格式：U+1234；等同于 "U+%04X"。
```

### **浮点数和复数：**

```
%b：以二进制指数形式表示（例如 -123456p-78）。
%e：科学计数法（例如 -1.234456e+78）。
%E：科学计数法（例如 -1.234456E+78）。
%f：小数点表示，不带指数（例如 123.456）。
%F：与 %f 等效。
%g：指数较大时使用 %e，否则使用 %f。精度见下文。
%G：指数较大时使用 %E，否则使用 %F。
%x：十六进制表示（带二进制指数），例如 -0x1.23abcp+20。
%X：大写十六进制表示，例如 -0X1.23ABCP+20。
```

### **字符串和字节切片（这些占位符下等效处理）：**

```
%s：以字节序列显示字符串或切片的原始内容。
%q：以双引号包裹的字符串，使用 Go 语法安全转义。
%x：十六进制表示，小写，每字节两个字符。
%X：十六进制表示，大写，每字节两个字符。
```

### **切片：**

```
%p：以十六进制表示第 0 个元素的地址，带 0x 前缀。
```

### **指针：**

```
%p：以十六进制表示，带 0x 前缀。
     占位符 %b、%d、%o、%x 和 %X 也适用于指针，格式化方式与整数相同。
```

### %v额外说明

默认情况下，%v 的格式为：

```
bool：                    %t
int, int8 等：            %d
uint, uint8 等：          %d，%#v 时为 %#x
float32, complex64 等：   %g
string：                  %s
chan：                    %p
pointer：                 %p
```

对于复合对象，元素会递归使用这些规则进行格式化，布局如下：

```
struct：             {field0 field1 ...}
array, slice：       [elem0 elem1 ...]
maps：               map[key1:value1 key2:value2 ...]
pointer to above：   &{}, &[], &map[]
```

### 宽度与精度

宽度由占位符前的十进制数字指定。如果省略，则宽度为表示值所需的最小宽度。精度由可选的宽度后的小数点和十进制数字指定。如果未指定小数点，则使用默认精度。小数点后无数字表示精度为零。示例：

```
%f     默认宽度，默认精度
%9f    宽度为 9，默认精度
%.2f   默认宽度，精度为 2
%9.2f  宽度为 9，精度为 2
%9.f   宽度为 9，精度为 0
```

宽度和精度以 Unicode 码点（即 rune）为单位测量（这与 C 的 printf 不同，C 中的单位始终以字节为单位）。

宽度或精度的标志可以用星号 (*) 替换，其值从下一个参数（待格式化的参数之前）获取，该参数必须是 int 类型。

对于大多数值，宽度是输出的最小字符数，如果需要，会用空格填充。但对于字符串、字节切片和字节数组，精度限制了输入的长度（而不是输出的大小），必要时会截断。通常以 rune 为单位测量，但对于这些类型，当使用 %x 或 %X 格式化时，以字节为单位测量。

对于浮点数，宽度设置字段的最小宽度，精度设置小数点后的位数（如果适用），除非对于 %g/%G，精度设置最大有效数字位数（会移除尾部零）。例如，对于 12.345，格式 %6.3f 输出 12.345，而 %.3g 输出 12.3。对于 %e、%f 和 %#g，默认精度为 6；对于 %g，默认为唯一标识值所需的最小数字位数。

对于复数，宽度和精度独立应用于两个分量，结果会用括号括起来，因此 %f 应用于 1.2+3.4i 会生成 (1.200000+3.400000i)。

当使用 %q 格式化单个整数码点或 rune 字符串（类型为 []rune）时，无效的 Unicode 码点会替换为 Unicode 替代字符 U+FFFD，如同 strconv.QuoteRune 的行为。

### 其他标志：

```
'+'：始终为数值打印符号；
     对于 %q，保证 ASCII-only 输出 (%+q)。
'-'：在右侧填充空格，而不是左侧（左对齐字段）。
'#'：备用格式：二进制前加 0b (%#b)，八进制前加 0 (%#o)，
     十六进制前加 0x 或 0X (%#x 或 %#X)；对于 %p，%#p 会抑制 0x；
     对于 %q，如果 [strconv.CanBackquote] 返回 true，则打印原始（反引号）字符串；
     对于 %e、%E、%f、%F、%g 和 %G，始终打印小数点；
     对于 %g 和 %G，不移除尾部零；
     对于 %U，如果字符可打印，则打印 e.g. U+0078 'x' (%#U)。
' '（空格）：为数值的省略符号留出空格 (% d)；
     以空格分隔打印字符串或切片的字节（% x, % X）。
'0'：以零填充，而不是空格；
     对于数值，这会将填充移至符号之后。
```

标志被不期望它们的占位符忽略。例如，没有备用十进制格式，因此 %#d 和 %d 的行为相同。

### Printf/Print/Println

对于每个类似 `Printf` 的函数，还有一个 `Print` 函数，它不接受格式，等同于为每个参数使用 %v。另一个变体 `Println` 会在参数之间插入空格，并追加换行符。

### 打印interface{}规则

无论使用什么占位符，如果操作数是接口值，则使用内部具体值，而不是接口本身。因此：

```go
var i interface{} = 23
fmt.Printf("%v\n", i)
```

会打印 23。

除了使用 %T 和 %p 打印时，对于实现某些接口的操作数，会应用特殊的格式化规则。按应用顺序：

1. 如果操作数是 `reflect.Value`，则用它持有的具体值替换操作数，然后继续打印。
2. 如果操作数实现了 `Formatter` 接口，则会调用该接口。在这种情况下，占位符和标志的解释由该实现控制。
3. 如果使用 %v 占位符且带有 # 标志 (%#v)，并且操作数实现了 `GoStringer` 接口，则会调用该接口。

如果格式（对于 `Println` 等隐式为 %v）适用于字符串 (%s %q %x %X)，或者为 %v 但不是 %#v，则适用以下两条规则：

1. 如果操作数实现了 `error` 接口，则会调用 `Error` 方法将对象转换为字符串，然后根据占位符（如果有）进行格式化。
2. 如果操作数实现了 `String()` string 方法，则会调用该方法将对象转换为字符串，然后根据占位符（如果有）进行格式化。

### 复合类型打印

对于复合操作数（如切片和结构体），格式适用于每个操作数的元素，递归应用，而不是整个操作数。因此，%q 会为字符串切片的每个元素添加引号，%6.2f 会控制浮点数数组每个元素的格式。

然而，当以类似字符串的占位符（%s %q %x %X）打印字节切片时，它会被视为字符串，作为一个单独的项目处理。

为了避免递归，例如：

```go
type X string
func (x X) String() string { return Sprintf("<%s>", x) }
```

在递归之前，应将值转换为其他类型：

```go
func (x X) String() string { return Sprintf("<%s>", string(x)) }
```

自引用数据结构（例如包含自身的切片）如果具有 `String` 方法，也可能引发无限递归。然而，这种病态情况较为罕见，`fmt` 包并未对其进行保护。

当打印结构体时，`fmt` 无法且不会调用未导出字段的格式化方法（如 `Error` 或 `String`）。

## 备注：常用占位符表

以下是 `fmt` 包中占位符的详细表格，包括占位符、类型、说明和备注：

| 占位符 | 类型        | 说明                                                         | 备注                              |
| ------ | ----------- | ------------------------------------------------------------ | --------------------------------- |
| `%v`   | 通用        | 默认格式显示值。对于结构体，`%+v` 显示字段名，`%#v` 显示 Go 语法表示。 | 适用于所有类型                    |
| `%T`   | 通用        | 显示值的 Go 类型                                             | 适用于所有类型                    |
| `%%`   | 通用        | 显示字面量百分号，不消耗值                                   | 无                                |
| `%t`   | 布尔        | 显示布尔值（`true` 或 `false`）                              | 无                                |
| `%b`   | 整数        | 二进制表示                                                   | 无                                |
| `%c`   | 整数        | 对应的 Unicode 码点表示的字符                                | 无                                |
| `%d`   | 整数        | 十进制表示                                                   | 无                                |
| `%o`   | 整数        | 八进制表示                                                   | 无                                |
| `%O`   | 整数        | 八进制表示，带 `0o` 前缀                                     | Go 1.13+                          |
| `%q`   | 整数/字符串 | 单引号或双引号包裹的字符或字符串，转义为 Go 语法             | 适用于 `rune` 和 `string`         |
| `%x`   | 整数/字符串 | 十六进制表示，小写字母                                       | 无                                |
| `%X`   | 整数/字符串 | 十六进制表示，大写字母                                       | 无                                |
| `%U`   | 整数        | Unicode 格式（`U+1234`），适用于单个 Unicode 码点            | 无                                |
| `%e`   | 浮点数      | 科学计数法（小写 `e`）                                       | 无                                |
| `%E`   | 浮点数      | 科学计数法（大写 `E`）                                       | 无                                |
| `%f`   | 浮点数      | 小数点表示，不带指数                                         | `%F` 是其别名                     |
| `%g`   | 浮点数      | 自动选择 `%e` 或 `%f`，根据数值大小                          | 精度为最大有效数字                |
| `%G`   | 浮点数      | 自动选择 `%E` 或 `%F`，根据数值大小                          | 精度为最大有效数字                |
| `%x`   | 浮点数      | 十六进制表示（带二进制指数）                                 | 小写，适用于浮点数                |
| `%X`   | 浮点数      | 十六进制表示（带二进制指数）                                 | 大写，适用于浮点数                |
| `%s`   | 字符串      | 显示字符串的原始内容                                         | 无                                |
| `%q`   | 字符串      | 双引号包裹的字符串，转义为 Go 语法                           | 无                                |
| `%x`   | 字符串      | 十六进制表示，每字节两个字符（小写）                         | 无                                |
| `%X`   | 字符串      | 十六进制表示，每字节两个字符（大写）                         | 无                                |
| `%p`   | 指针/切片   | 显示地址或指针值，带 `0x` 前缀                               | 适用于指针和切片的第 0 个元素地址 |
| `%+v`  | 通用        | 显示结构体字段名                                             | 仅适用于结构体                    |
| `%#v`  | 通用        | 显示值的 Go 语法表示                                         | 适用于所有类型                    |
| `%#b`  | 整数        | 二进制表示，带 `0b` 前缀                                     | 无                                |
| `%#o`  | 整数        | 八进制表示，带 `0` 前缀                                      | 无                                |
| `%#x`  | 整数        | 十六进制表示，带 `0x` 前缀                                   | 无                                |
| `%#X`  | 整数        | 十六进制表示，带 `0X` 前缀                                   | 无                                |
| `%#q`  | 字符串      | 使用反引号包裹的字符串（如果可打印）                         | 仅适用于可打印字符串              |
| `%#U`  | 整数        | 显示 Unicode 码点和字符（如果可打印）                        | 无                                |
| `%#p`  | 指针        | 显示指针值，不带 `0x` 前缀                                   | 无                                |

- `%+v` 和 `%#v` 提供了更详细的输出，适用于调试。
- `%q` 和 `%x` 对于字符串和字节切片有不同的行为。
- `%p` 用于显示地址，但对切片会显示第 0 个元素的地址。
- `%#` 标志用于显示更详细的格式化信息。